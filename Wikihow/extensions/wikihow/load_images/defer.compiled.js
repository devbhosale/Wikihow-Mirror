(function(){window.defer={debug:[],imgs:[],loadTimes:[],showConsole:!1,allIn:!1,dur:200,domWait:2E3,domTimer:null,"int":0,loading:0,loaded:0,active:!1,callback:null,listen:function(){this.active=!0;this.addEvent(window,"load",this.winLoaded);this.run();this["int"]=setInterval(defer.run,this.dur)},addCallback:function(a){this.callback=a},winLoaded:function(){defer.allIn=!0},run:function(){defer.allIn&&defer.removeLoaded();defer.allIn&&0===defer.imgs.length?defer.destroy():(defer.checkAll(),0===defer.loading&&
defer.bg.check())},add:function(a){a.defer={src:a.getAttribute("data-src"),index:this.imgs.length,loading:!1,loaded:!1};a.defer.src&&a.defer.src.match(/images(_[a-z]{2})?\/thumb\//)&&!a.defer.src.match(/(\.[a-zA-Z]+){2}$/)&&this.supportsWebp()&&(a.defer.src+=".webp");this.imgs.push(a);this.domTimer&&clearTimeout(this.domTimer);this.domTimer=setTimeout(defer.winLoaded,this.domWait);this.browserSupports()?this.active||this.listen():this.loadImg(a)},imgLoaded:function(a){a=defer.getTarget(a);var b=(new Date).getTime();
a&&(a.defer.loaded=!0,defer.trace("#"+a.defer.index+" loaded"),defer.removeEvent(a,"load",defer.imgLoaded),defer.loadTimes.push(b-a.defer.loadStart),defer.callback&&defer.callback(b));defer.loaded+=1;--defer.loading},imgError:function(a){(a=defer.getTarget(a))&&a.defer&&(a.defer.loaded=!0);--defer.loading},loadImg:function(a){this.loading+=1;this.trace("#"+a.defer.index+" requested");this.addEvent(a,"load",this.imgLoaded);this.addEvent(a,"error",this.imgError);a.src=a.defer.src;a.removeAttribute("style");
a.defer.loading=!0;a.defer.loadStart=(new Date).getTime()},removeLoaded:function(){var a,b=[];for(a=0;a<this.imgs.length;a+=1)this.imgs[a].defer.loaded?delete this.imgs[a].defer:b.push(this.imgs[a]);this.imgs=b},checkAll:function(){var a,b;for(a=0;a<this.imgs.length;a+=1)b=this.imgs[a],this.inView(b)&&!b.defer.loading&&this.loadImg(b)},inView:function(a){a=a.getBoundingClientRect();var b=window.innerHeight||document.documentElement.clientHeight;return 0<=a.bottom&&a.top<=b},destroy:function(){this.trace("shutdown");
clearInterval(this["int"]);this.active=!1;this.loading=0;this.allIn=!1;this.imgs=[];defer.bg.avg=0;defer.bg.batchSize=10;defer.bg.found=0;this.debug=[]},trace:function(a,b){if(void 0!==window.console&&this.showConsole)console[b||"log"](a);else this.debug.push(a)},supportsWebp:function(){if("undefined"==typeof this.webp){var a=navigator.userAgent;this.webp=!!(a.match(/Linux/)&&a.match(/Android/)||a.match(/Opera/)||a.match(/Chrome/)&&!a.match(/Edge/))}return this.webp},browserSupports:function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&
7>=parseInt(RegExp.$1,10))return!1;var a=document.body;return a.getBoundingClientRect&&(window.innerHeight||document.documentElement.clientHeight)&&(a.attachEvent||a.addEventListener)},getTarget:function(a){a=a||window.event;var b;a&&(b=a.target||a.srcElement);return b},addEvent:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},removeEvent:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.attachEvent&&a.detachEvent("on"+b,c)}}})();
(function(){defer.bg={enabled:!0,batchSize:10,avg:0,found:0,speeds:[{lbl:"Modem",speed:4E3,batch:1},{lbl:"EDGE",speed:1E3,batch:3},{lbl:"DSL",speed:100,batch:5},{lbl:"Cable",speed:50,batch:10}],check:function(){this.enabled&&(this.findSpeed(),this.findImgs())},findImgs:function(){for(var a=0,b;a<defer.imgs.length;){b=defer.imgs[a];b.defer.loading||(this.found+=1,defer.trace("bg found #"+b.defer.index+" | "+this.found+" of "+this.batchSize+" limit"),defer.loadImg(b));if(this.batchFull()){this.found=
0;break}a+=1}},batchFull:function(){return this.batchSize<=this.found},findSpeed:function(){if(0===defer.loadTimes.length)this.batchSize=this.speeds[0].batch;else{var a=0,b,c=defer.loadTimes.length,d=c;for(b=0;b<c;b+=1)!isNaN(defer.loadTimes[b])&&0<defer.loadTimes[b]?a+=parseFloat(defer.loadTimes[b],null):--d;this.avg=0<d?(a/d).toPrecision(5):0;defer.trace(this.avg+" avg DL time");for(a=0;a<this.speeds.length;a+=1)if(b=this.speeds[a],this.avg>b.speed){this.batchSize=b.batch;break}}}}})();
